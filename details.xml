<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE vxml PUBLIC "-//W3C//DTD VOICEXML 2.1//EN" "http://www.w3.org/TR/2007/REC-voicexml21-20070619/vxml.dtd">

<vxml version="2.1" xmlns="http://www.w3.org/2001/vxml" xmlns:voxeo="http://community.voxeo.com/xmlns/vxml" application="root.xml">
    <meta name="maintainer" content="burrelal@gmail.com" />

    <script><![CDATA[
        var apiUrl = "https://maps.googleapis.com/maps/api/place/textsearch/xml?query={query}&key=AIzaSyCVqHbaIe-Dtnt7WUHGOHUAUuV1_OWFoag";

        function assembleUrl(location, business) {
            location = location.replace(" ", "+");
            business = business.replace(" ", "+");
            return apiUrl.replace("{query}", location+"+"+business);
        }

        function parseResults(results) {
            return results.getElementsByTagName("result").length;
        }
    ]]></script>

    <form id="GetDetails">
        <block>
            <!-- <prompt>
                <value expr="application.request_type" />
                <value expr="application.business" />
                <value expr="application.location" />
            </prompt> -->

            <data name="SearchResults" srcexpr="assembleUrl(application.location, application.business)" />
            <assign name="SearchResults" expr="SearchResults.documentElement" />
            <assign name="application.result" expr="parseResults(SearchResults)" />
			<goto next="#ProvideResults" />
        </block>
    </form>
    
    <form id="ProvideResults">
    	<field>
    		<prompt>
	    		Providing <value expr="application.request_type"/> for <value expr="application.business"/>
    	    	in <value expr="application.location"/>. <break strength="weak" />
        		<value expr="application.result" />. <break strength="weak" />
        	</prompt>
    	</field>
    	
    	<filled>
    	</filled>
    </form>

</vxml>
